# Сравнение расширений `pg_trgm` и `pg_bigm` в PostgreSQL

## Данные

**users:**
- john_doe
- jon_doe
- longusernameuser12345
- johndoe123456789
- janet
- completelydifferentusername

**products:**
- Apple iPhone 14
- iPhone 14 Pro Max
- Samsung Galaxy S23
- OnePlus 9 Pro
- VeryVeryLongProductNameToTestBigmAndTrgmMatching

---

## Индексы

- `pg_trgm`: GIN по `gin_trgm_ops`
- `pg_bigm`: GIN по `gin_bigm_ops`

---

## Тестовые запросы (оператор `%` - похожесть)

### Тест 1: Короткие строки (похожее) — `username % 'john_doe'`

| Расширение | Время выполнения | Кол-во найденных строк |
|------------|------------------|------------------------|
| pg_trgm    | 151.887 ms       | 1941                   |
| pg_bigm    | 388.738 ms       | 1941                   |

---

### Тест 2: Средние строки (похожее) — `name % 'iPhone 14'`

| Расширение | Время выполнения | Кол-во найденных строк |
|------------|------------------|------------------------|
| pg_trgm    | 7.961 ms         | 6                      |
| pg_bigm    | 541.737 ms       | 6                      |

---

### Тест 3: Длинные строки (похожее) — `name % 'VeryVeryLongProductNameToTestBigmAndTrgmMatching'`

| Расширение | Время выполнения | Кол-во найденных строк |
|------------|------------------|------------------------|
| pg_trgm    | 20.862 ms        | 3                      |
| pg_bigm    | 782.841 ms       | 3                      |

---

### Тест 4: Очень похожие строки (ошибка в 1 символе) — `username % 'jon_doe'`

| Расширение | Время выполнения | Кол-во найденных строк |
|------------|------------------|------------------------|
| pg_trgm    | 27.308 ms        | 8                      |
| pg_bigm    | 167.222 ms       | 8                      |

---

### Тест 5: Полностью непохожие строки — `username % 'completelydifferentusername'`

| Расширение | Время выполнения | Кол-во найденных строк |
|------------|------------------|------------------------|
| pg_trgm    | 3.672 ms         | 0                      |
| pg_bigm    | 259.445 ms       | 0                      |

---

## similarity() при использовании `pg_trgm`

### Поиск похожих на `'john_doe'`

| username     | similarity |
|--------------|------------|
| john_doe     | 1.0        |
| jon_doe      | 0.545      |
| jane.doe     | 0.385      |
| johnsonjohn  | 0.357      |
| jonesjohn    | 0.357      |

### Поиск похожих на `'completelydifferentusername'`

| username | similarity |
|----------|------------|
| —        | —          |

---

## Выводы

- `pg_trgm` работает значительно быстрее, особенно на длинных строках и при большом количестве данных.
- `pg_bigm` даёт аналогичные результаты, но медленнее во всех тестах.
- `pg_trgm` поддерживает функцию `similarity()` и даёт адекватную градацию схожести.
- В ситуациях, где требуется высокая производительность поиска по похожим строкам, `pg_trgm` предпочтительнее.
